<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="financial-pattern-footer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<dom-module id="financial-patternworkshop-pro">

  <template>
      <style include="app-grid-style" type="text/css">
        :host{
          display: block;
          color:#000000;
          width:65%;
          font-size: 14px;
          margin:30px auto;
          padding:0;
          height:auto;
          --app-grid-columns:3;
          --app-grid-expandible-item-columns: 2;
        }
        .item:nth-child(2){
          @apply(--app-grid-expandible-item);
        }
        .item{
          border:1px solid #ddd;
          text-align: center;
        }
        table{
          width:99%;
          border-spacing: 0;
          margin:5px auto;

        }
        .topTable tr{
          float:left;
          width:50%;
        }
        .topTable tr td{
          border:1px solid #ddd;
        }
        .topTable tr td:first-child{
          width:98px;
          background:#0f0;
          border:1px solid #ddd;
        }
        .topTable tr td:nth-child(2){
          width:96px;
        }
        .middleTable tr{
          width:100%;
        }
        .middleTable tr td{
          width:16%;
          border:1px solid #ddd;
        }
        input{
          width:60px;
          height:21px;
        }

        .FS,.G{
          border:1px solid #ddd;
        }
        .FS input,.G input{
          width:110px;
        }
        .link{
          font-weight:bold;
          font-size: 16px;
        }
        paper-button {
          padding:0.1em 0;
          min-width: 2.14em ;
          margin:0;
          height:2.14em;
          font-size:12px;
          --paper-button:{
           text-transform: none;
         }
        }
        paper-dropdown-menu{
          width:6.5em;
          padding:0;
        }
        paper-dropdown-menu.runStatus{
          width:9.5em;
        }
        paper-dropdown-menu.outTW{
          width:14.5em;
        }
        paper-item{
          width:100%;
        }
        paper-input-container{
          padding:0;
        }
        .mainTop{
          margin:5px;
        }
        .mainTop paper-button{
          min-width: 1.14em ;
        }
        .mainBottom{
          margin-left:5px;
        }
        .mainBottom div{
          margin-bottom: 5px;
        }
        .mainBottom  paper-button.ok{
          min-width: 5.14em ;
        }
        .mainBottom input.long{
          width:84%;
        }
        .finalFooter paper-button{
          min-width: 5.14em ;
          margin-left:7px;
        }
        .finalFooter iframe{
          margin-left:10px;
        }
        .patternworkshopPro{
          margin-bottom: 15px;
        }
        financial-pattern-footer{
          font-size:16px;
        }
        paper-button{
          background-color: #ededed;
        }
      </style>
    <div class="patternworkshopPro">
        <form name="outForm" id="outForm" action="{{appData}}/wbfpwoutput" method="POST" target="_blank">
            <input type="hidden" id="submitValue" name="submitValue" value="" />
        </form>
        <input type="hidden" name="mlmfile" id="mlmfile" value="wbfpwoutput" />
        <input type="hidden" name="fpwulvl" id="fpwulvl" value="{{fpwulvl}}" />
        <input type="hidden" name="mlid" id="mlid" value="{{userName}}" />
        <input type="hidden" name="mlid4" id="mlid4" value="{{userName4}}" />
        <input type="hidden" name="WhereOrderFrom" id="WhereOrderFrom" value="SLFE" />
        <input type="hidden" name="filetypeid" id="filetypeid" value="out" />
        <input type="hidden" name="outrunindex" id="outrunindex" value="{{outIndex}}" />
        <input type="hidden" name="FirstorS" id="FirstorS" value="{{firstors}}" />
        <input type="hidden" name="hdoutfindex" id="hdoutfindex" value="{{outFindex}}" />
        <input type="hidden" name="hdouttindex" id="hdouttindex" value="{{outTindex}}" />
        <input type="hidden" name="hdoutmxi" id="hdoutmxi" value="{{outMxi}}" />
        <input type="hidden" name="hdchartdatem" id="hdchartdatem" value="{{chartData}}" />
        <input type="hidden" name="fpwsource" id="fpwsource" value="{{fpwSource}}" />
        <input type="hidden" name="hdoutonoff" id="hdoutonoff" value="KaKaKa" />
        <input type="hidden" name="hdoutGOror" id="hdoutGOror" value="KaKaKa" />
      <div class="app-grid">
        <div class="item">
            <table class="topTable">
              <template is="dom-repeat" items="{{topItem}}"><tr><td>{{item.name}}</td><td >{{item.value}}</td></tr></template>
            </table>
            <table class="middleTable">
              <tr><td><a href="javascript:void(0);" on-click="_handleEntryClick">Entry</a></td><td>Mon</td><td>Tue</td><td>Wed</td><td>Thu</td><td>Fri</td></tr>
              <tr><td>$Net</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Win</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Loss</td><td></td><td></td><td></td><td></td><td></td></tr>
            </table>
            <table class="middleTable">
              <tr><td>Exit</td><td>Mon</td><td>Tue</td><td>Wed</td><td>Thu</td><td>Fri</td></tr>
              <tr><td>$Net</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Win</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Loss</td><td></td><td></td><td></td><td></td><td></td></tr>
            </table>
            <table class="middleTable">
              <tr><td>Vol</td><td>Mon</td><td>Tue</td><td>Wed</td><td>Thu</td><td>Fri</td></tr>
              <tr><td>$Net</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Win</td><td></td><td></td><td></td><td></td><td></td></tr>
              <tr><td>Loss</td><td></td><td></td><td></td><td></td><td></td></tr>
            </table>
            <div class="FS">
                <paper-button raised on-click="_handleDeleteClick" title="Delete previously saved simulation result, will open an interface to let user choose.">Del</paper-button>
                <paper-button raised on-click="_handleLoadClick">Load</paper-button>
                <input is="iron-input" name="outptname"  bind-value="{{outputName}}"/>
                <paper-button raised on-click="_handleSaveClick" id="outSave">Save</paper-button>
                <paper-button raised on-click="" >|</paper-button>
                <a class="link" href="" name="">FS</a>
                <paper-dropdown-menu id="outFSspan" name="outFSspan" value="" dynamicAlign="true">
                    <paper-listbox class="dropdown-content" selected="1">
                      <template is="dom-repeat" items="{{timeInterval}}" >
                        <paper-item label="{{item.value}}">
                          <span>{{item.name}}</span></paper-item>
                      </template>
                    </paper-listbox>
                </paper-dropdown-menu>
                <paper-button raised on-click="_handleGoClick" >Go</paper-button>
            </div>
            <div class="G">
                <a class="link" href="" name="">G:</a>
                <paper-button raised on-click="_handleNewGeneticRunClick" id="outGOror">New Genetic Run</paper-button>
                <paper-button raised on-click="_handle1Click">1</paper-button>
                <paper-button raised on-click="">12</paper-button>
                <paper-button raised on-click="">123</paper-button>
                <paper-button raised on-click="">12X</paper-button>
                <paper-button raised on-click="">123X</paper-button>
                <input is="iron-input" name="outGOsm" validator="" bind-value="{{outGosm}}"/>
            </div>
        </div>
        <div class="item">
            <div class="mainTop">
              <paper-dropdown-menu id="outDSM" class="runStatus" name="outDSM" value="{{selectedItem}}" dynamicAlign="true">
                  <paper-listbox class="dropdown-content" selected="1" >
                    <template is="dom-repeat" items="{{runStatus}}" >
                      <paper-item value="{{item.value}}"><span>{{item.name}}</span></paper-item>
                    </template>
                  </paper-listbox>
              </paper-dropdown-menu>
              <paper-button raised on-click="_handleRunClick" id="outDSMRun">Run</paper-button>
              <paper-dropdown-menu id="outTW" class="outTW" name="outTW" value="{{selectedItem}}" dynamicAlign="true">
                  <paper-listbox class="dropdown-content" selected="1">
                    <template is="dom-repeat" items="{{outTW}}" >
                      <paper-item value="{{item.value}}"><span>{{item.name}}</span></paper-item>
                    </template>
                  </paper-listbox>
              </paper-dropdown-menu>
              <paper-button raised on-click="_handleTransferClick" id="outTGo">Transfer</paper-button>
              <span class="link">F</span>
              <paper-button raised on-click="javascript: onclickFT(50,'F','L');" ><-</paper-button>
              <paper-button raised on-click="javascript: onclickFT(1,'F','L');" ><</paper-button>
              <input is="iron-input" name="outFdate" id="outFdate" validator="" bind-value="{{outFdate}}"/>
              <paper-button raised on-click="javascript: onclickFT(1,'F','R');" >></paper-button>
              <paper-button raised on-click="javascript: onclickFT(50,'F','R');" >>-</paper-button>
              <span class="link">T</span>
              <paper-button raised on-click="javascript: onclickFT(50,'T','L');" ><-</paper-button>
              <paper-button raised on-click="javascript: onclickFT(1,'T','L');" ><</paper-button>
              <input is="iron-input" name="outTdate" id="outTdate" validator="" bind-value="{{outTdate}}"/>
              <paper-button raised on-click="javascript: onclickFT(1,'T','R');" >></paper-button>
              <paper-button raised on-click="javascript: onclickFT(50,'T','R');" >-></paper-button>
              <paper-button raised on-click="_handleNETgoClick" id="outNETgo">Go</paper-button>
              <paper-button raised on-click="_handleOutNClick" >{{outn}}</paper-button>
              <paper-button raised on-click="_handleoutonoffClick" id="outonoff">{{outOnoff}}</paper-button>
            </div>
            <div><img src="../images/fpwoutjpeg.jpg" /></div>
            <div class="mainBottom">
                <div>
                  <a href="">Any:</a>
                  <input is="iron-input" name="outAnyU" id="outAnyU" class="long" validator="" bind-value="{{outAnyU}}"/>
                  <input is="iron-input" name="outAnyS" id="outAnyS" validator="" bind-value="{{outAnyS}}"/>
                </div>
                <div>
                  <paper-button raised on-click="_handleViewClick" >View</paper-button>
                  <input is="iron-input" class="long" name="outAnyD" id="outAnyD" validator="" bind-value="{{outAnyD}}"/>
                  <paper-button class="ok" raised on-click="_handleOKClick" >OK</paper-button>
                </div>
            </div>
        </div>
      </div>
      <div class="app-grid finalFooter">
        <div class="item">
          <paper-button raised on-click="" >T-List</paper-button>
          <paper-button raised on-click="" >Setup Chart</paper-button>
          <paper-button raised on-click="" >Statistics ||</paper-button>
          <paper-button raised on-click="" >Portfolio</paper-button>
          <paper-button raised on-click="" >Time</paper-button>
        </div>
        <div class="item">
          <iframe name="FPWoutstatus" width="807" height="22" src="{{outStatus}}">
            Your browser does not support inline frames or is currently configured not to display inline frames.</iframe>
        </div>
      </div>

    </div>
    <financial-pattern-footer user-name="{{userName}}"></financial-pattern-footer>
  </template>
  <script>
    Polymer({

      is: 'financial-patternworkshop-pro',
      properties: {
          fpwulvl:String,
        userName: String,
        userName4:String,
          appData:String,
          outIndex:String,
          firstors:String,
          outFindex:String,
          outTindex:String,
          outMxi:String,
          chartData:String,
          fpwSource:String,

          outputName:String,
          outAnyU:String,
          outAnyS:String,
          outAnyD:String,
          outGosm:String,
          outStatus:String,
          outFdate:String,
          outTdate:String,
          outn:String,
          outOnoff:String,
          outJpeg:String,

          oA12:String,
          oA14:String,
          oA22:String,
          oA24:String,
          oA32:String,
          oA34:String,
          oA42:String,
          oA44:String,
          oA52:String,
          oA54:String,
          oA74:String,
          oA64:String,
          oA72:String,
          oA62:String,
          oA82:String,
          oA84:String,
          my:String,

        topItem:String,
        middleItem:String,
        bottomItem:String,
        winNo:String,
        timeInterval:String,
        runStatus:String,
        outTW:String,


          // findex:String,
          // tindex:String,
          // mxi:String,
          fpwmiddle1:String,

      },
      ready:function(){
        this.topItem=[
          {"name":"Win No","value":this.oA12},
          {"name":"Max D/D","value":this.oA14},
          {"name":"Loss No.","value":this.oA22},
          {"name":" Ave. Trade","value":this.oA24},
          {"name":"Win %","value":this.oA32},
          {"name":"Ave. Win","value":this.oA34},
          {"name":" $ / DD1 / Y","value":this.oA42},
          {"name":" Ave. Loss","value":this.oA44},
          {"name":" $ / DD3 / Y","value":this.oA52},
          {"name":"Max Win","value":this.oA54},
          {"name":"$ / DD1 / Y5","value":this.oA74},
          {"name":" Max Loss","value":this.oA64},
          {"name":" Equity","value":this.oA72},
          {"name":"Pr. Factor","value":this.oA62},
          {"name":"Max FP (TD)","value":this.oA82},
          {"name":"Max. Con. L","value":this.oA84}
        ],
        this.timeInterval = [
          {"name":"Daily","value":"DD"},
          {"name":"5 Min","value":"T05"},
          {"name":"15 Min","value":"T15"},
          {"name":"T30","value":"T30"},
          {"name":"Hourly","value":"T60"}
        ],
        this.runStatus= [
          {"name":"Simulation 1","value":"1"},
          {"name":"Simulation 2","value":"2"},
          {"name":"Simu 2+1","value":"3"},
          {"name":"Decom 1","value":"4"},
          {"name":"Decom 2","value":"5"},
          {"name":"MMFuture 1","value":"6"},
          {"name":"MMFuture 2","value":"7"},
          {"name":"MMStock 1","value":"8"},
          {"name":"MMStock 2","value":"9"},
          {"name":"MM DcomF","value":"10"},
          {"name":"MM DcomS","value":"11"}
        ],
        this.outTW=[
          {"name":"Simu 1 <-> Simu 2","value":"1"},
          {"name":"Decom 1 <-> Decom 2","value":"2"},
          {"name":"Decom 1 -> Simu 1","value":"3"},
          {"name":"Decom 2 -> Simu 1","value":"4"},
          {"name":"Simu 1 -> Decom 1","value":"5"},
        ],
         this.outFindex=parseInt(this.outFindex);//后台无数据返回时parseInt(undefined),结果为NaN
         this.outTindex=parseInt(this.outTindex);
         this.outMxi=parseInt(this.outMxi);
      },
        outsavehddata:function() {
           this.chartData='k';
           this.$.hdoutonoff.value = this.outOnoff;
           var val=this.$.outGOror.innerText.toString();
           this.$.hdoutGOror.value=val;
          // this.$.hdoutGOror.value="New Genetic Run";
         },
        beforesavedata:function() {
          this.fpwmiddle1=this.chartData;
        },
        aftersavedata:function() {
           this.chartData=this.fpwmiddle1;
         },
         onclickFT:function(num,str1,str2) {
             	this.firstors='1';
             // 	var findex=this.outFindex;
             // 	var tindex=this.tindex;
             // 	var mxi=this.mxi;
             	if (str1=='F') {
             	  {
             	  if (str2=='L')

             	    if(1 > this.outFindex-num)
             		this.outFindex = 1;
             	    else
             		this.outFindex = this.outFindex-num;
             	  else
             	    if(this.outMxi > this.outFindex+num)
             		this.outFindex = this.outFindex+num;
             	    else
             		this.outFindex = this.outMxi;
             	  }
             	  var sub1=this.chartData.substr(6*(this.outFindex-1),6);
             	  this.outFdate=sub1.substr(0,2)+'/'+sub1.substr(2,2)+'/'+sub1.substr(4,2);
             	}
             	else {
             	  {
             	  if (str2=='L')

             	    if(1 > this.outTindex-num)
             		this.outTindex= 1;
             	    else
             		this.outTindex= this.outTindex-num;
             	  else
             	    if(this.outMxi > this.outTindex+num)
             		this.outTindex= this.outTindex+num;
             	    else
             		this.outTindex= this.outMxi;
             	  }
             	  var sub1=this.chartData.substr(6*(this.outTindex-1),6);
             	  this.outTdate=sub1.substr(0,2)+'/'+sub1.substr(2,2)+'/'+sub1.substr(4,2);
             	  }
             },
            onclickyouhua1s:function(str) {
               var submitForm=this.$.outForm;
             	if (this.fpwulvl=='4') {
             	 this.beforesavedata();
             	 this.outsavehddata();
             	 this.outIndex='21';
             	 this.$.mlmfile.value='wbfpwoutany';
             	 var str3 = this.outAnyU;
             	 if (str!='1') {
             	 this.outAnyU =str;
             	 }
             	 this.firstors='1';
               this.colectSubmitValue();
               submitForm.action="[[appData]]/wbfpwoutany";
             	 submitForm.submit();
             	 this.aftersavedata();
             	 this.outAnyU =str3;
             	}
             },
            mysleep:function(tmiliseconds) {
                var currentTime = new Date().getTime();
                while (currentTime+tmiliseconds>=new Date().getTime()) {}
              },

           onclickyouhua1a:function() {
                 var str = this.outAnyU;
                 var dlinms = 10;
                 var str2 = this.userName;
                   str2=str2.toUpperCase();
                 if (str2.indexOf('AARONZHU')>-1) {
                 	dlinms = 10000;}
                 var strnew=str.toUpperCase();
             	if (strnew.indexOf('SUPERDAY')>-1 || strnew.indexOf('DAYALL')>-1) {
             	 		this.onclickyouhua1s('myday');
             	 		this.mysleep(1.5*dlinms);
             	 		this.onclickyouhua1s('new');
             	 		this.mysleep(1.8*dlinms);
             	 		this.onclickyouhua1s('tick60');
             	 		this.mysleep(0.8*dlinms);
             	 		this.onclickyouhua1s('long');
             	 	   	}
             	 else if (strnew.indexOf('TICKALL')>-1) {
             	 	 	this.onclickyouhua1s('tick5');
             	 	 	this.mysleep(dlinms);
             	 		this.onclickyouhua1s('tick10');
             	 		this.mysleep(1.2*dlinms);
             	 		this.onclickyouhua1s('tick15');
             	 		this.mysleep(dlinms);
             	 		this.onclickyouhua1s('tick30');
             	 		this.mysleep(dlinms);
             	 		this.onclickyouhua1s('tick60');
             	 			}
             	 else {
             	 		this.onclickyouhua1s('1');
             	 		}
             },
             colectSubmitValue:function(str){
               var submitForm=this.$.outForm;
               var submitInput=this.$.submitValue;
               var mlmfile=this.$.mlmfile.value;
               var hdoutonoff=this.$.hdoutonoff.value;
               var hdoutGOror=this.$.hdoutGOror.value;
               var selectFs=this.$.outFSspan.value;
               var selectTw=this.$.outTW.value;
               var selectDsm=this.$.outDSM.value;
               submitInput.value='{"mlmfile":"'+mlmfile+'","fpwulvl":"'+this.fpwulvl+'","mlid":"'+this.userName+'","mlid4":"'+this.userName4+'","WhereOrderFrom":"SLFE","filetypeid":"out","outrunindex":"'+this.outIndex+'","FirstorS":"'+this.firstors+
               '","hdoutfindex":"'+this.outFindex+'","hdouttindex":"'+this.outTindex+'","hdoutmxi":"'+this.outMxi+'","hdchartdatem":"'+this.chartData+'","hdoutonoff":"'+hdoutonoff+'","hdoutGOror":"'+hdoutGOror+'","outTdate":"'+this.outTdate+'","outTdate":"'+this.outTdate+'","outptname":"'+
               this.outputName+'","outFSspan":"'+selectFs+'","outAnyU":"'+this.outAnyU+'","outAnyD":"'+this.outAnyD+'","outGOsm":"'+this.outGOsm+'","outDSM":"'+selectDsm+'","outTW":"'+selectTw+'"}';
               submitForm.action="[[appData]]/"+str;
               submitForm.submit();
             },
             _handleGoClick:function(){


             },
             _handleTransferClick:function(){
                this.beforesavedata();
                this.outsavehddata();
                this.outIndex="32";
                this.$.outTGo.target = "FPWoutstatus";
                this.firstors="1";
                this.colectSubmitValue();
                this.aftersavedata();
             },
             _handleRunClick:function(){
               this.outsavehddata();
               this.outIndex="31";
               this.firstors="1";
               this.colectSubmitValue("wbfpwoutput");
             },
            _handleNETgoClick:function(){
              this.outsavehddata();
              this.outIndex="11";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleOutNClick:function(){
              this.outonoff="1";
              this.outsavehddata();
              this.outIndex="11";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleoutonoffClick:function(){
              if(this.outonoff=="1"){
                this.outonoff="0";
              }else{
                this.outonoff="1";
              }
            },
            _handleEntryClick:function(){

            },
            _handleDeleteClick:function(){
              this.outsavehddata();
              this.outIndex="35";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleLoadClick:function(){
              this.outsavehddata();
              this.outIndex="34";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleSaveClick:function(){
              this.beforesavedata();
              this.outsavehddata();
              this.outIndex="33";
              this.$.outSave.tartget="FPWoutstatus";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleViewClick:function(){
              if(this.fpwulvl=="4"){
                this.beforesavedata();
                this.outsavehddata();
                this.outIndex="17";
                this.firstors="1";
                this.colectSubmitValue("wbfpwanyview");
                this.aftersavedata();
              }
            },
            _handleOKClick:function(){
              this.outsavehddata();
              this.outIndex="16";
              this.firstors="1";
              this.colectSubmitValue("wbfpwoutput");
            },
            _handleNewGeneticRunClick:function(){
              var strs=this.$.outGOror.innerText.toString();
                if(strs=="New Genetic Run"){
                  this.$.outGOror.innerText="Review Latest Run";
                }else{
                  this.$.outGOror.innerText="New Genetic Run";
                }
            },
            _handle1Click:function(){
                this.onclickyouhua1a();
            },
    });
  </script>
</dom-module>
