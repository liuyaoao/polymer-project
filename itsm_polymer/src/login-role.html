<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="css/page-styles.html">

<link rel="import" href="./redux/actions/userLogin-mixin.html">


<dom-module id="login-role">

  <template>
    <style include="page-styles">
    </style>
    <div class="login_bg">
      <h1 title="SiteView ITOSS IT运营支持平台"><img src="../images/slogo.svg" alt=""></h1>
      <div class="content">
        <div class="role-select">
          <h5>可用角色</h5>
          <ul>
            <iron-selector role="navigation" selected="{{roleName}}" attr-for-selected="name">
              <dom-repeat items="[[roleList]]" as="item">
                <template>
                  <li name="[[item.name]]" on-click="_showRoleDes" args="[[item]]">
                    <img src="" alt="">
                    [[item.name]]
                  </li>
                </template>
              </dom-repeat>
            </iron-selector>
          </ul>
          <div class="des">
            角色说明: [[roleDes]]
          </div>
          <paper-button raised class="indigo right" on-click="_selectedRole">
            确定
          </paper-button>
        </div>
        <p class="copyRight">版权所有 北京游龙网网络科技有限公司</p>
      </div>
    </div>
  </template>

  <script>
      class LoginRole extends UserLoginMixin(Polymer.Element) {

      static get is() { return 'login-role'; }
      static get properties() {
        return {
          categoryName: String,

          roleList:{
            type: Array,
            statePath: 'userReducer.userRoles'
          },

          roleName: String,

          roleDes: String,

          roleObj: Object,

          userToken: {
            type: String,
            statePath: 'userReducer.userToken'
          },

          // defaultCategoryName: {
          //   type: String,
          //   statePath: 'userReducer.defaultCategoryName'
          // }

        };
      }

      ready(){
        this.addEventListener('click', this._focusInput.bind(this));
        super.ready();
      }

      _showRoleDes(e){
        var path = e.composedPath();
        var args = {};
        if(path.length >=0 ){
          args = path[0].args;
          this.roleDes = args.description;
          this.roleObj = args;
        }
      }

      _selectedRole(){
        var _this = this;
        var data = _this.roleObj;
        var userToken = _this.userToken;
        $.ajax({
          type: "POST",
          url: Window.AppConfig.serverUrl+"/foundation/api/v1/auth/selectRole?token=" + userToken,
          async : true,
          contentType: "application/json",
          dataType: "json",
          data: JSON.stringify(data),
          success: function(data){
            _this.dispatch("setUserSelectedRole", _this.roleObj.alias);
          },
          error: function(error){
            console.log("errorMsg",error);
          }
        });


      }

      _focusInput() {
        var _input = this.root.querySelector('input');
        // console.log(_input);
        if (_input) {
          _input.focus();
        }
      }

      _removeWidget(e) {
        var gridItem = this.parentNode.parentNode;
        // console.log(gridItem);
        if (gridItem.classList.contains('grid-stack-item')) {
          this.dispatchEvent(new CustomEvent('remove-widget', {detail: gridItem, bubbles: true, composed: true}));
        }

      }

    }

    window.customElements.define(LoginRole.is, LoginRole);
  </script>
</dom-module>
