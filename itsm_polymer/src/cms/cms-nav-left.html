
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<!-- <link rel="import" href="../lazy-library.html"> -->

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel='import' href='../../bower_components/paper-item/paper-icon-item.html'>

<!-- <link rel="import" href="../bower_components/paper-button/paper-button.html"> -->
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../themes/change-theme.html">

<dom-module id="cms-nav-left">
  <template>
    <style>
      :host{
        display: block;
        height:100%;
        float:left;
        position:relative;
        overflow: hidden;
        /*margin：0 10px;*/
        --side-item-text: {
          color: var(--primary-text-color);
          font-weight: 600;
          font-size: 16px;
        };
      }
      :host aside.siderbar_left paper-menu paper-icon-item iron-icon{
        --iron-icon-fill-color:var(--help-icon-color);
      }
      :host .spread_fold_btn{
        position:absolute;
        right:-15px;
        top:50%;
        z-index:29;
      }
      :host .help_btn{
        position:absolute;
        right:-10px;
        top:60%;
        color:var(--help-icon-color);
        z-index:29;
      }
      :host .settings_btn{
        position:absolute;
        right:-10px;
        top:64%;
        color:var(--primary-text-color);
        z-index:29;
      }
      :host aside.siderbar_left{
        padding-top:5px;
        width:200px;
        height:100%;
        transition: width 0.5s ease-in-out;
        box-shadow:2px 2px 3px  rgba(0, 0, 0, 0.4);
        position:fixed;
      }
      :host aside.siderbar_left_small{
        width:60px;
        transition: width 0.5s ease-in-out;
      }
      paper-menu {
        height: 98%;
        overflow: auto;
        padding-bottom: 0;
        /*background-color: #fff;*/
      }

      paper-icon-item {
        --paper-icon-item: {
          cursor: pointer;
        };

        --paper-item-icon: {
          opacity: var(--dark-secondary-opacity);
        };

        --paper-item-selected: {
          /*color: var(--default-primary-color);*/
          background-color: var(--paper-grey-200);
          opacity: 1;
        };
      }
      paper-menu a {
        text-decoration: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-decoration: none;
      }
      paper-menu paper-icon-item .item-text {
        display:inline-block;
        width:100%;
        height:100%;
        @apply(--side-item-text);
      }
      paper-menu paper-icon-item .item-text.fold-text{
        display:none;
      }
      /*paper-icon-item.iron-selected {
        opacity: 1;
      }*/
      /*paper-icon-item.feedback {
        margin-top: 16px;
      }*/
      paper-icon-item:hover {
        background-color: var(--light-primary-color);
        padding-right:0;
        transition:padding-right 0.3s;
      }
      paper-icon-item[aria-selected],paper-icon-item.iron-selected {
        --paper-item-icon: {
          color: var(--secondary-text-color);
          opacity: 1;
        };
        border-right:4px solid var(--dark-primary-color);
      }

    </style>
    <app-location route="{{location}}"></app-location>
    <aside class="siderbar_left" id="siderbarLeft">
      <paper-icon-button icon="[[spreadFoldIcon]]" on-click="_clickSpreadFold" class="spread_fold_btn"></paper-icon-button>
      <paper-icon-button icon="help" on-click="_clickHelp" class="help_btn"></paper-icon-button>
      <paper-icon-button icon="settings" on-click="_clickSettings" class="settings_btn"></paper-icon-button>
      <div class="siderbar_container">
        <paper-menu attr-for-selected='datapanel' selected='[[currentPanel]]' on-iron-select='_onMenuSelect'>
            <paper-icon-item two-line on-tap='_onMenuItemClicked' datapanel='modules' data-href="cms/modules">
              <iron-icon slot="item-icon" class="item-icon" icon='home'></iron-icon>
              <span class='item-text'>应用</span>
              <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item two-line on-tap='_onMenuItemClicked' datapanel='perspective' data-href="cms/perspective">
                <iron-icon slot="item-icon" class="item-icon" icon='view-agenda'></iron-icon>
                <span class='item-text'>透视</span>
                <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' datapanel='businessobj'  data-href="cms/businessobj">
                <iron-icon slot="item-icon" class="item-icon" icon='apps'></iron-icon>
                <span class='item-text'>业务对象</span>
                <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' datapanel='ruledefinition' data-href="cms/ruledefinition">
              <iron-icon slot="item-icon" class="item-icon" icon='build'></iron-icon>
              <span class='item-text'>规则定义</span>
              <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' datapanel='datadefinition' data-href="cms/datadefinition">
              <iron-icon slot="item-icon" class="item-icon" icon='settings-applications'></iron-icon>
              <span class='item-text'>数据结果集定义</span>
              <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' datapanel='modeldefinition' data-href="cms/modeldefinition">
              <iron-icon slot="item-icon" class="item-icon" icon='settings'></iron-icon>
              <span class='item-text'>数据模型定义</span>
              <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' datapanel='layoutsetting' data-href="cms/layoutsetting">
              <iron-icon slot="item-icon" class="item-icon" icon='view-array'></iron-icon>
              <span class='item-text'>门户布局</span>
              <paper-ripple></paper-ripple>
            </paper-icon-item>

            <paper-icon-item on-tap='_onMenuItemClicked' class='changetheme'>
              <iron-icon slot="item-icon" class="item-icon" icon='stars'></iron-icon>
              <change-theme label="[[themeLabel]]" class="change_theme"></change-theme>
            </paper-icon-item>
        </paper-menu>
      </div>

    </aside>

  </template>

  <script>

    class CmsNavLeft extends Polymer.Element {
      static get is() { return 'cms-nav-left'; }
      static get properties() {
        return {
          appTitle: String,
          themeLabel:{
            type:String,
            value:'改变主题：',
          },
          spreadFoldIcon:{
            type:String,
            value:'chevron-left'
          },
          pageCntMarginLeft:{
            type:String,
            value:'200px',
            notify:true
          },
          currentPanel:{
            type:String,
            // value:'perspective',
          },
          smallScreen: Boolean,
        }
      }

      ready(){
        super.ready();
        setTimeout(()=>{
          this._updateLeftBarStyle();
        },100);
        // this._updateLeftBarStyle();
      }
      _clickSpreadFold(evt){ //点击了折叠展开侧边栏按钮。
        let siderbarLeft = this.$.siderbarLeft;
        console.log("点击了展开折叠的事件：",evt);
        this._toggleClass("siderbar_left_small",siderbarLeft);
        let itemTextEles = siderbarLeft.querySelectorAll('.item-text');
        setTimeout(()=>{
          for(let i=0;i<itemTextEles.length;i++){
            this._toggleClass("fold-text",itemTextEles[i]);
          }
        },200);
        if(siderbarLeft.className.indexOf('siderbar_left_small') == -1){ //折叠起来，只保留图标。
          this.spreadFoldIcon = 'chevron-left';
          this.pageCntMarginLeft = '200px';
        }else{ //展开来。
          this.spreadFoldIcon = 'chevron-right';
          this.pageCntMarginLeft = '60px';
        }
      }
      _clickHelp(evt){ //点击了帮助图标

      }
      _clickSettings(evt){ //点击了设置图标

      }
      _onMenuItemClicked(evt){
        console.log("_onMenuItemClicked:",evt);
        let href = evt.currentTarget.getAttribute("data-href");
        href?this.set("location.path",href):null;
      }
      _onMenuSelect(item){
        console.log("_onMenuSelect:",item);
      }
      connectedCallback() {
        super.connectedCallback();
        this._boundResizeHandler = this._resizeHandler.bind(this);
        window.addEventListener('resize', this._boundResizeHandler);
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        window.removeEventListener('resize', this._boundResizeHandler);
      }
      _resizeHandler() {
        this._resizeDebouncer = Polymer.Debouncer.debounce(this._resizeDebouncer,
          Polymer.Async.timeOut.after(50), () => {
            this.updateStyles();
            this._updateLeftBarStyle();
          }
        );
      }
      _updateLeftBarStyle(){
        let siderbarLeft = this.$.siderbarLeft;
        siderbarLeft.style.height = (document.innerHeight-60)+"px";
      }
      _toggleClass(name,node){
        let className = node.className;
        let classNameArr = className.split(' ');
        if(classNameArr.indexOf(name) == -1){
          classNameArr.push(name);
        }else{
          classNameArr.splice(classNameArr.indexOf(name), 1);
        }
        node.className = classNameArr.join(' ');
      }


    }

    customElements.define(CmsNavLeft.is, CmsNavLeft);

  </script>

</dom-module>
